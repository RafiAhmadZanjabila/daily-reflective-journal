{% extends 'app/layout.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}Mood Entry{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'app/styles/mood_detail.css' %}">
<link rel="stylesheet" href="{% static 'app/styles/weather-icons.min.css' %}">
{% endblock %}
{% block content %}
<div class="container mt-5 mood-detail">
    <h1><i>I'm feeling</i><br><span style="color: {{ entry.emotion_color }};">{{ entry.emotion.name }}</span></h1>
    <div class="entry-layout">
        <div class="entry-text mt-2">
            <p style="color: rgb(110,110,110);">
                Temperature: {{ entry.temperature }}Â°C&nbsp;
                <i class="wi {{ entry.weather_condition|weather_icon }}"></i><br>
                Sleep: {{ entry.sleep_time|minutes_to_hours_minutes }}<br>
                Exercise: {{ entry.exercise_minutes|minutes_to_hours_minutes }}<br>
                Steps: {{ entry.steps }}<br>
            </p>
            <h4 class="mt-4">{{ entry.description|linebreaksbr }}</h4>
            <div class="options-group mb-4">
                {% for theme in entry.themes.all %}
                    <div class="option-item selected">{{ theme.name }}</div>
                {% endfor %}
                {% for place in entry.places.all %}
                    <div class="option-item selected">{{ place.name }}</div>
                {% endfor %}
                {% for surrounding in entry.surroundings.all %}
                    <div class="option-item selected">{{ surrounding.name }}</div>
                {% endfor %}
            </div>
            <p><small>{{ entry.created_at|date:"F j, Y h:i A" }}</small></p>
            <button id="delete-entry-btn" class="btn btn-danger mt-2">Delete</button>
        </div>
    </div>
</div>
<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    document.getElementById('delete-entry-btn').addEventListener('click', function() {
        if (confirm('Are you sure you want to delete this entry?')) {
            fetch("{% url 'delete_mood' entry.id %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = "{% url 'mood_home' %}";
                } else {
                    alert('An error occurred while deleting the entry.');
                }
            });
        }
    });
</script>
{% endblock %}